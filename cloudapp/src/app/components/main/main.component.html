<!-- action buttons -->
<div class="eca-actions">
  <button mat-flat-button color="secondary" (click)="reset()"
    [disabled]="(!sourceUser && !searchTerm) || loading || loadUsers">{{ 'main.resetButton' | translate }}</button>
  <button mat-flat-button color="primary" (click)="copyUserRoles()"
    [disabled]="(!currentUserEntity || !sourceUser) || loading || loadUsers">{{Â 'main.copyUserRolesButton' | translate
    }}
  </button>
</div>
<!-- action buttons -->

<!-- target user -->
<mat-card>
  <h1 translate>main.targetUserTitle</h1>
  <mat-card-content *ngIf='!currentUserEntity'>
    <p translate>
      main.selectTargetUserInfo
    </p>
  </mat-card-content>
  <mat-card-content *ngIf='currentUserEntity'>
    <p translate>main.rolesCopyToTargetInfo</p>
    <p class="cur-username">
      <span class="uxf-icon uxf-user cur-leading-icon"></span> {{currentUserEntity.description}}
    </p>
    <mat-checkbox [(ngModel)]="replaceExistingRoles">{{ 'main.replaceExistingRolesCheckboxLabel' | translate }}
    </mat-checkbox>
  </mat-card-content>
</mat-card>
<!-- /target user -->

<!-- source user -->
<mat-card>
  <h1 translate>main.sourcUserTitle</h1>
  <mat-card-content [style.display]="currentUserEntity ? 'none' : 'block'">
    <p translate>
      main.selectTargetFirstInfo
    </p>
  </mat-card-content>
  <mat-card-content [style.display]="!currentUserEntity ? 'none' : 'block'">
    <p class="cur-username" *ngIf="sourceUser" [ngPlural]="sourceUser.user_role?.length">
      <span class="uxf-icon uxf-user cur-leading-icon"></span> {{sourceUser.last_name}}, {{sourceUser.first_name}} -
      {{sourceUser.user_role?.length}} <ng-template ngPluralCase="=1">{{ 'main.role' | translate }}</ng-template>
      <ng-template ngPluralCase="other">{{ 'main.roles' | translate }}</ng-template>
    </p>
    <p class="cur-bold" *ngIf="!sourceUser" translate>
      main.searchUserInfo
    </p>
    <!-- search input -->
    <mat-form-field class="cur-full-width" appearance="fill">
      <mat-label translate>main.findUserLabel</mat-label>
      <input matInput type="text" #searchTermInput id="searchTerm" name="searchTerm" (keydown.enter)="findUser()"
        [(ngModel)]="searchTerm" [disabled]='loadUsers'>
      <button matSuffix mat-icon-button aria-label="Search" (click)="findUser()">
        <mat-icon>search</mat-icon>
      </button>
    </mat-form-field>
    <!-- /search input -->
    <p *ngIf="resultCount >= 0" translate [translateParams]="{ resultCount: resultCount }">
      main.resultCountLabel <span *ngIf="resultCount > pageSize" translate
        [translateParams]="{ pageSize: pageSize }">main.resultCountInfo</span>
    </p>
    <p class="cur-bold" *ngIf="resultCount > 0" translate>
      main.selectUserFromListInfo
    </p>
    <!-- search result list -->
    <div>
      <mat-selection-list #sourceUserList [multiple]="false" [(ngModel)]="sourceUserOptions"
        (ngModelChange)="selectSourceUser($event)">
        <mat-list-option class="cur-list-option" matTooltip="{{resultEntity.primary_id}}" *ngFor="let resultEntity of resultEntites" [value]="resultEntity">
          <div>
            <span class="uxf-icon uxf-user cur-leading-icon"></span>
            {{resultEntity.last_name}}, {{resultEntity.first_name}} -
            {{resultEntity?.user_group?.desc.trim()}}&nbsp;[{{resultEntity?.user_group?.value}}] -
            <span *ngIf="resultEntity?.user_role" [ngPlural]="resultEntity?.user_role?.length">
              {{resultEntity?.user_role?.length}}&nbsp;<ng-template ngPluralCase="=1">{{ 'main.role' | translate }}
              </ng-template>
              <ng-template ngPluralCase="other">{{ 'main.roles' | translate }}</ng-template>
            </span>
            <br>
            <span class="cur-roles-valid" *ngIf="resultEntity.rolesChecked">
              <span *ngIf="resultEntity.rolesChecked && resultEntity.rolesValid"><span
                  class="uxf-icon uxf-check"></span>&nbsp;{{ 'main.rolesValid' | translate }}</span>
              <span *ngIf="resultEntity.rolesChecked && !resultEntity.rolesValid"><span
                  class="uxf-icon uxf-flash"></span>&nbsp;{{ 'main.rolesValid' | translate }}</span>
            </span>
          </div>
        </mat-list-option>
      </mat-selection-list>
    </div>
    <!-- /search result list -->
    <div class="loading-shade" *ngIf="loadUsers">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  </mat-card-content>
</mat-card>
<!-- /source user -->

<div class="loading-shade" *ngIf="loading">
  <mat-spinner diameter="50"></mat-spinner>
</div>